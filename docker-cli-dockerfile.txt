# Dockerfile para o CLI e Painel Admin do WhatsApp Messenger
FROM python:3.9-slim

# Metadados
LABEL maintainer="Seu Nome <seu.email@dominio.com>"
LABEL version="1.0"
LABEL description="WhatsApp Messenger CLI e Painel Administrativo"

# Variáveis de ambiente
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1
ENV TZ=America/Sao_Paulo

# Instala ferramentas essenciais
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    gnupg \
    ca-certificates \
    nodejs \
    npm \
    procps \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Configura diretório de trabalho
WORKDIR /app

# Copia arquivos de requisitos primeiro para aproveitar o cache
COPY requirements.txt .

# Instala dependências Python
RUN pip install --no-cache-dir -r requirements.txt

# Copia todos os arquivos do projeto
COPY . .

# Torna os scripts executáveis
RUN chmod +x whatsapp_cli.py admin_panel.py

# Configurações para portas e volumes
EXPOSE 8080
VOLUME ["/app/data", "/app/.whatsapp-cli"]

# Informa comandos disponíveis
RUN echo "Comandos disponíveis:" \
    && echo "- python whatsapp_cli.py [comando]" \
    && echo "- python admin_panel.py" \
    && echo "- ./whatsapp_cli.py [comando]" \
    && echo "- ./admin_panel.py"

# Por padrão, inicia o painel de administração
CMD ["python", "admin_panel.py", "--host", "0.0.0.0", "--port", "8080"]
